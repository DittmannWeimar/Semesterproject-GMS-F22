import Temperature
import TemperatureHumidity
import Moisture
import Pump
import avarage
import LED
import Line
import pow
import time

System:

	Gateway test_gateway:
		mac 11:22:33:44:55:66
		Worker test_worker1:
			mac AA:BB:CC:DD:EE:FF
			sleep for 10 minutes
			broadcast for 20 seconds
			
			Sensor TemperatureHumidity temp1:
				pins 1, 2
				rate 10
				out "temperature" as temp with mapping call pow(2, value)
				out "humidity" as hum
				behavior avarage(100)
				sample if temp1.temp == TRUE
				graph temperatureGraph
				
			Sensor Moisture moist1:
				pins 5,6,7,8
				rate 1
				out as moisture
				
			Actuator LED led1:
				pins 3
				setting threshold = 2
				setting brightness = 0.35
				when temp1.temp > threshold + moist1.moisture * 2
				
			Actuator Pump:
				pins 9,10,11,12
				setting pumpTime = 10
				on moist1.moisture < 10 + led1.brightness
				off 2 + 10 < moist1.moisture > 20
			
			Actuator Pump:
				pins 9,10,11,12
				setting pumpTime = 10
				on moist1.moisture < 10 run for 10 minutes
	
	Graph Line temperatureGraph:
		category "basics"
		title "Temperature"
		x "Time"
		y "Degrees (C)"